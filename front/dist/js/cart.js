(()=>{const t=document.getElementById("cart__items");let e,o=[],r=[];fetch("https://kanap-api-back.herokuapp.com/api/products").then((t=>t.json())).then((t=>{e=t})).then((()=>{for(Item of((()=>{const t=[];for(i=0;i<localStorage.length;i++)t.push(localStorage.key([i]));for(key of t)o.push(JSON.parse(localStorage[key]))})(),o))for(Couch of e)Item.product_id===Couch._id&&r.push([Couch,{color:Item.product_color,quantity:Item.product_quantity}]);r.map(((e,o)=>{const r=document.createElement("article");r.innerHTML=`\n\t\t\t\t        <div class="cart__item__img">\n\t\t\t\t        <img src=${e[0].imageUrl} alt=${e[0].name}>\n\t\t\t\t      </div>\n\t\t\t\t      <div class="cart__item__content">\n\t\t\t\t        <div class="cart__item__content__description">\n\t\t\t\t          <h2>${e[0].name}</h2>\n\t\t\t\t          <p>${e[1].color}</p>\n\t\t\t\t          <p>${e[0].price}</p>\n\t\t\t\t        </div>\n\t\t\t\t        <div class="cart__item__content__settings">\n\t\t\t\t          <div class="cart__item__content__settings__quantity">\n\t\t\t\t            <p>Qté : </p>\n\t\t\t\t            <input type="number" class="itemQuantity" name="itemQuantity" min="1" max="100" value=${e[1].quantity}>\n\t\t\t\t          </div>\n\t\t\t\t          <div class="cart__item__content__settings__delete">\n\t\t\t\t            <p class="deleteItem">Supprimer</p>\n\t\t\t\t          </div>\n\t\t\t\t        </div>\n\t\t\t\t      </div>`,r.classList.add("cart__item"),r.setAttribute("data-id",e[0]._id),r.setAttribute("data-color",e[1].color),r.setAttribute("data-index",o),t.appendChild(r)}))})).then((()=>{document.querySelectorAll("article").forEach((t=>{!async function(){const t=[];for(Item of r)t.push(Item[0].price*Number(Item[1].quantity));let e=await t.reduce(((t,e)=>t+e),0);document.querySelector("#totalPrice").textContent=e+".00"}(),t.querySelector(".itemQuantity").addEventListener("change",(async function(e){const r=o.findIndex((e=>e.product_id===t.dataset.id&&e.product_color===t.dataset.color));o[r].product_quantity=e.target.value,await localStorage.setItem(localStorage.key(r),JSON.stringify(o[r])),window.location.reload()})),t.querySelector(".deleteItem").addEventListener("click",(async function(){const e=o.findIndex((e=>e.product_id===t.dataset.id&&e.product_color===t.dataset.color));await localStorage.removeItem(localStorage.key(e)),o.splice(e,1),window.location.reload()})),document.querySelector("#order").addEventListener("click",(async function(t){t.preventDefault(),async function(){a=e.querySelector("#firstName").value,n=e.querySelector("#lastName").value,c=e.querySelector("#address").value,i=e.querySelector("#city").value,s=e.querySelector("#email").value}(),await async function(t,e,r,a,n){let c={};if(function(t,e,o,r,a){let n=!1,c=!1,i=!1,d=!1,u=!1;return""!==t?t.match(/[a-zA-Z]/g).length!==t.length?l("firstNameErrorMsg","Les chiffres et les caractères spéciaux ne sont pas autorisés pour cette entrée"):n=!0:l("firstNameErrorMsg"),""!==e?e.match(/[a-zA-Z]/g).length!==e.length?l("lastNameErrorMsg","Les chiffres et les caractères spéciaux ne sont pas autorisés pour cette entrée"):c=!0:l("lastNameErrorMsg"),""!==o?i=!0:l("addressErrorMsg"),""!==r?d=!0:l("cityErrorMsg"),""!==a?s.includes("@")?u=!0:l("emailErrorMsg","Cette entrée doit recevoir une donnée de type email (ex: email@exemple.com)"):l("emailErrorMsg"),!!(n&&c&&i&&d&&u)}(t,e,r,a,n)){c={firstName:t,lastName:e,address:r,city:a,email:n};const s=[];for(Product of o)s.push(Product.product_id);const l={contact:c,products:s};await("https://kanap-api-back.herokuapp.com/api/products/order",i=l,console.log(i),void fetch("https://kanap-api-back.herokuapp.com/api/products/order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}).then((t=>t.json())).then((t=>{console.log("DATAS ENVOYEE AVEC SUCCES VOICI LES DATAS",t),window.location.assign(`./confirmation.html?orderId=${t.orderId}`)})))}var i}(a,n,c,i,s)}));const e=document.querySelector("form");let a,n,c,i,s;function l(t,o="Vous devez remplir cette entrée"){const r=e.querySelector(`#${t}`);r.textContent=o,setTimeout((()=>{r.textContent=""}),4e3)}}))})).catch((t=>console.error(t)))})();